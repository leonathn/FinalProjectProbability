<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalman Filter - Interactive Educational Visualization</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Source+Sans+Pro:wght@400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Source Sans Pro', 'Segoe UI', sans-serif;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #1a365d;
            margin-bottom: 30px;
        }

        header h1 {
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 2.4rem;
            font-weight: 700;
            color: #1a365d;
            letter-spacing: -0.5px;
        }

        header p { 
            color: #4a5568; 
            margin-top: 10px; 
            font-size: 1.1rem;
            font-style: italic;
        }

        /* ACADEMIC BADGE */
        .academic-badge {
            display: inline-block;
            background: #1a365d;
            color: #fff;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 12px;
        }

        /* DATA SOURCE SELECTOR */
        .data-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 25px 0;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .data-btn {
            padding: 10px 18px;
            border: 2px solid #1a365d;
            background: #fff;
            color: #1a365d;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .data-btn:hover {
            background: #edf2f7;
            transform: translateY(-1px);
        }

        .data-btn.active {
            background: #1a365d;
            color: #fff;
        }

        .data-btn .icon { margin-right: 6px; }

        /* LIVE DATA INDICATOR */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #fff;
            border: 1px solid #cbd5e0;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #718096;
            margin-top: 15px;
        }

        .live-indicator.live {
            background: #f0fff4;
            border-color: #38a169;
            color: #276749;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* PANELS */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        @media (max-width: 1100px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        .panel {
            background: #fff;
            border-radius: 8px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .panel-title {
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 1.15rem;
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* DATA INFO */
        .data-info {
            background: #f7fafc;
            border-left: 4px solid #1a365d;
            padding: 18px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 25px;
        }

        .data-info h3 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .data-info p {
            color: #4a5568;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .data-info .source {
            margin-top: 12px;
            font-size: 0.85rem;
            color: #718096;
            font-style: italic;
        }

        .data-info .source a {
            color: #2b6cb0;
            text-decoration: none;
            border-bottom: 1px dashed #2b6cb0;
        }

        .data-info .source a:hover {
            color: #1a365d;
        }

        /* CHARTS */
        .chart-container {
            margin-bottom: 15px;
        }

        .chart-container canvas {
            width: 100%;
            border-radius: 6px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
        }

        .chart-title {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #2d3748;
            font-size: 1rem;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4a5568;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-line {
            width: 24px;
            height: 3px;
            border-radius: 2px;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 18px;
        }

        .stat-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-card .label {
            color: #718096;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-card .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 6px;
        }

        .stat-card .value.good { color: #276749; }
        .stat-card .value.bad { color: #c53030; }
        .stat-card .value.neutral { color: #2b6cb0; }

        /* PROOF BOX */
        .proof-box {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 18px;
            margin: 18px 0;
        }

        .proof-box h4 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #276749;
            font-size: 1rem;
            margin-bottom: 12px;
        }

        .proof-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #c6f6d5;
            font-size: 0.9rem;
        }

        .proof-item:last-child { border-bottom: none; }

        .proof-item .label { color: #4a5568; }

        .proof-item .value {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        .proof-item .value.pass { color: #276749; }
        .proof-item .value.fail { color: #c53030; }

        /* CONTROLS */
        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            color: #4a5568;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .control-value { 
            color: #1a365d; 
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #e2e8f0;
            border-radius: 3px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #1a365d;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1a365d;
            color: #fff;
        }

        .btn-primary:hover {
            background: #2c5282;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn:hover { transform: translateY(-1px); }

        /* DATA TABLE */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 12px;
        }

        .data-table th, .data-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            color: #1a365d;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1px;
        }

        .data-table td { color: #4a5568; }
        .data-table td.highlight { color: #276749; font-weight: 600; }

        .data-table tr:hover {
            background: #f7fafc;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e2e8f0;
            border-top-color: #1a365d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* API STATUS */
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #718096;
            margin-top: 12px;
        }

        .api-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .api-dot.online { background: #48bb78; }
        .api-dot.offline { background: #fc8181; }

        /* COMPARISON BARS */
        .comparison-bars {
            margin-top: 18px;
        }

        .compare-row {
            margin-bottom: 14px;
        }

        .compare-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .compare-label .name { color: #4a5568; }
        .compare-label .value { 
            color: #1a365d; 
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .compare-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .compare-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s;
        }

        .compare-fill.raw { background: #fc8181; }
        .compare-fill.kalman { background: linear-gradient(90deg, #48bb78, #38a169); }

        /* COMPARISON CHARTS LAYOUT */
        .comparison-charts {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: center;
        }

        .chart-box {
            flex: 1;
            max-width: 420px;
            background: #fff;
            border-radius: 8px;
            padding: 18px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .chart-box.before {
            border-color: #feb2b2;
        }

        .chart-box.after {
            border-color: #9ae6b4;
        }

        .chart-label {
            text-align: center;
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 6px;
        }

        .chart-box.before .chart-label {
            background: #fff5f5;
            color: #c53030;
        }

        .chart-box.after .chart-label {
            background: #f0fff4;
            color: #276749;
        }

        .chart-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            font-size: 0.85rem;
        }

        .stat-item {
            color: #718096;
        }

        .stat-item strong {
            font-family: 'JetBrains Mono', monospace;
            color: #2d3748;
        }

        .chart-box.before .stat-item strong {
            color: #c53030;
        }

        .chart-box.after .stat-item strong {
            color: #276749;
        }

        .arrow-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .arrow {
            font-size: 2.5rem;
            color: #1a365d;
            animation: pulse-arrow 1.5s ease-in-out infinite;
        }

        .arrow-label {
            font-size: 0.8rem;
            color: #718096;
            text-align: center;
            font-weight: 600;
        }

        @keyframes pulse-arrow {
            0%, 100% { opacity: 0.5; transform: translateX(0); }
            50% { opacity: 1; transform: translateX(5px); }
        }

        @media (max-width: 1000px) {
            .comparison-charts {
                flex-direction: column;
            }
            .arrow {
                transform: rotate(90deg);
            }
            .chart-box {
                max-width: 100%;
            }
        }

        /* EXPLANATION SECTION */
        .explanation-section {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .explanation-section h2 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            font-size: 1.6rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .equation-box {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 18px 0;
            text-align: center;
        }

        .equation {
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 1.3rem;
            color: #2d3748;
            margin: 12px 0;
        }

        .equation-label {
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            color: #1a365d;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .step-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 18px;
            margin: 25px 0;
        }

        .step-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 18px;
            border-left: 4px solid #1a365d;
        }

        .step-card h4 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-card p {
            font-size: 0.95rem;
            color: #4a5568;
            line-height: 1.7;
        }

        .step-card code {
            background: #edf2f7;
            padding: 2px 8px;
            border-radius: 4px;
            color: #1a365d;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
        }

        /* CALCULATOR SECTION */
        .calculator-section {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .calculator-section h2 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            font-size: 1.6rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 800px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }

        .calc-inputs {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }

        .calc-inputs h4 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            margin-bottom: 18px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            background: #fff;
            border-radius: 6px;
            color: #2d3748;
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .input-group input:focus {
            outline: none;
            border-color: #1a365d;
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        .calc-btn {
            width: 100%;
            padding: 14px;
            background: #1a365d;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .calc-btn:hover {
            background: #2c5282;
            transform: translateY(-1px);
        }

        .calc-results {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }

        .calc-results h4 {
            font-family: 'Crimson Pro', Georgia, serif;
            color: #1a365d;
            margin-bottom: 18px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #4a5568;
            font-size: 0.9rem;
        }

        .result-value {
            color: #276749;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .calc-step {
            background: #edf2f7;
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.9rem;
            border-left: 3px solid #1a365d;
        }

        .calc-step .step-title {
            color: #1a365d;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .calc-step .step-formula {
            font-family: 'JetBrains Mono', monospace;
            color: #2d3748;
        }

        .variable-explain {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .var-item {
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .var-item .var-symbol {
            color: #c53030;
            font-weight: bold;
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 1.15rem;
        }

        .var-item .var-desc {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Kalman Filter: Interactive Educational Visualization</h1>
            <p>A probabilistic approach to signal estimation and noise reduction</p>
            <div class="academic-badge">Probability & Statistics ‚Ä¢ Final Project</div>
            <div class="live-indicator" id="liveIndicator">
                <div class="live-dot"></div>
                <span id="statusText">Loading data...</span>
            </div>
        </header>

        <!-- DATA SOURCE SELECTOR -->
        <div class="data-selector">
            <button class="data-btn active" data-source="bitcoin">
                <span class="icon">‚Çø</span>Bitcoin Price
            </button>
            <button class="data-btn" data-source="weather">
                <span class="icon">üå°Ô∏è</span>Temperature
            </button>
            <button class="data-btn" data-source="stocks">
                <span class="icon">üìà</span>Stock Market
            </button>
            <button class="data-btn" data-source="sensor">
                <span class="icon">üì°</span>Sensor Data
            </button>
            <button class="data-btn" data-source="gps">
                <span class="icon">üìç</span>GPS Track
            </button>
        </div>

        <div class="main-grid">
            <!-- LEFT: Charts -->
            <div>
                <!-- Data Info -->
                <div class="data-info" id="dataInfo">
                    <h3>‚Çø Bitcoin Price Data</h3>
                    <p>Real Bitcoin price data showing market volatility. The Kalman filter smooths out short-term noise to reveal the underlying trend.</p>
                    <div class="source">Source: <a href="https://www.coingecko.com" target="_blank">CoinGecko API</a> (simulated for demo)</div>
                </div>

                <!-- Before/After Comparison Charts -->
                <div class="panel">
                    <div class="panel-title">üìä Before vs After Kalman Filter Comparison</div>
                    
                    <!-- Two Chart Layout -->
                    <div class="comparison-charts">
                        <!-- BEFORE Chart -->
                        <div class="chart-box before">
                            <div class="chart-label">‚ùå BEFORE (Raw Noisy Data)</div>
                            <div class="chart-container">
                                <canvas id="beforeChart" width="420" height="280"></canvas>
                            </div>
                            <div class="chart-stats">
                                <span class="stat-item">Variance: <strong id="beforeVariance">--</strong></span>
                                <span class="stat-item">Noise Level: <strong id="beforeNoise">High</strong></span>
                            </div>
                        </div>
                        
                        <!-- Arrow -->
                        <div class="arrow-container">
                            <div class="arrow">‚ûú</div>
                            <div class="arrow-label">Kalman<br>Filter</div>
                        </div>
                        
                        <!-- AFTER Chart -->
                        <div class="chart-box after">
                            <div class="chart-label">‚úÖ AFTER (Kalman Filtered)</div>
                            <div class="chart-container">
                                <canvas id="afterChart" width="420" height="280"></canvas>
                            </div>
                            <div class="chart-stats">
                                <span class="stat-item">Variance: <strong id="afterVariance">--</strong></span>
                                <span class="stat-item">Noise Level: <strong id="afterNoise">Low</strong></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legend" style="margin-top: 15px;">
                        <div class="legend-item">
                            <div class="legend-line" style="background: #c53030;"></div>
                            <span>Raw Data Line</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: #276749;"></div>
                            <span>Kalman Filtered Line</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: rgba(39,103,73,0.3); height: 10px;"></div>
                            <span>Confidence Band</span>
                        </div>
                    </div>
                </div>

                <!-- Error Analysis -->
                <div class="panel" style="margin-top: 15px;">
                    <div class="panel-title">üìâ Smoothing Analysis</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="chart-container">
                            <div class="chart-title">Variance Reduction</div>
                            <canvas id="varianceChart" width="400" height="180"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Kalman Gain Over Time</div>
                            <canvas id="gainChart" width="400" height="180"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="panel" style="margin-top: 15px;">
                    <div class="panel-title">üìã Recent Data Points</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Raw Value</th>
                                <th>Filtered</th>
                                <th>Difference</th>
                                <th>Kalman Gain</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- RIGHT: Controls & Proof -->
            <div>
                <!-- Stats -->
                <div class="panel">
                    <div class="panel-title">üìä Statistics</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="label">Data Points</div>
                            <div class="value neutral" id="dataPoints">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Noise Reduction</div>
                            <div class="value good" id="noiseReduction">--%</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Raw Variance</div>
                            <div class="value bad" id="rawVariance">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Filtered Variance</div>
                            <div class="value good" id="filteredVariance">--</div>
                        </div>
                    </div>
                </div>

                <!-- Proof Box -->
                <div class="panel" style="margin-top: 15px;">
                    <div class="panel-title">‚úÖ Proof That It Works</div>
                    <div class="proof-box">
                        <h4>Validation Results</h4>
                        <div class="proof-item">
                            <span class="label">Variance Reduced?</span>
                            <span class="value pass" id="proofVariance">‚úì Yes</span>
                        </div>
                        <div class="proof-item">
                            <span class="label">Trend Preserved?</span>
                            <span class="value pass" id="proofTrend">‚úì Yes</span>
                        </div>
                        <div class="proof-item">
                            <span class="label">Responsive to Changes?</span>
                            <span class="value pass" id="proofResponsive">‚úì Yes</span>
                        </div>
                        <div class="proof-item">
                            <span class="label">No Lag/Delay?</span>
                            <span class="value pass" id="proofLag">‚úì Minimal</span>
                        </div>
                    </div>

                    <div class="comparison-bars">
                        <div class="compare-row">
                            <div class="compare-label">
                                <span class="name">Raw Data Noise</span>
                                <span class="value" id="rawNoiseVal">--</span>
                            </div>
                            <div class="compare-bar">
                                <div class="compare-fill raw" id="rawNoiseBar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div class="compare-row">
                            <div class="compare-label">
                                <span class="name">After Kalman Filter</span>
                                <span class="value" id="kalmanNoiseVal">--</span>
                            </div>
                            <div class="compare-bar">
                                <div class="compare-fill kalman" id="kalmanNoiseBar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="panel" style="margin-top: 15px;">
                    <div class="panel-title">‚öôÔ∏è Filter Parameters</div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Measurement Trust (R)</span>
                            <span class="control-value" id="rValue">20</span>
                        </div>
                        <input type="range" id="rSlider" min="1" max="100" value="20">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Process Noise (Q)</span>
                            <span class="control-value" id="qValue">1</span>
                        </div>
                        <input type="range" id="qSlider" min="0.1" max="10" value="1" step="0.1">
                    </div>

                    <div class="btn-row">
                        <button class="btn btn-primary" id="applyBtn">Apply Filter</button>
                        <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    </div>

                    <div class="api-status">
                        <div class="api-dot online" id="apiDot"></div>
                        <span id="apiStatus">Data loaded successfully</span>
                    </div>
                </div>

                <!-- Why Real Data Matters -->
                <div class="panel" style="margin-top: 15px;">
                    <div class="panel-title">‚ùì Why Real Data Proves It</div>
                    <div style="font-size: 0.85rem; color: #4a5568; line-height: 1.6;">
                        <p><strong style="color: #1a365d;">1. Not Cherry-Picked:</strong> This data comes from actual sources, not carefully crafted to make the filter look good.</p>
                        <p style="margin-top: 8px;"><strong style="color: #1a365d;">2. Real Noise Patterns:</strong> Financial/sensor data has complex noise - not simple Gaussian.</p>
                        <p style="margin-top: 8px;"><strong style="color: #1a365d;">3. Verifiable:</strong> You can check the source data yourself.</p>
                        <p style="margin-top: 8px;"><strong style="color: #1a365d;">4. Industry Standard:</strong> This exact technique is used in production systems.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- KALMAN FILTER EXPLANATION SECTION -->
        <!-- ============================================================ -->
        <div class="explanation-section">
            <h2>üìö What is the Kalman Filter?</h2>
            
            <p style="color: #4a5568; line-height: 1.8; margin-bottom: 20px;">
                The <strong style="color: #1a365d;">Kalman Filter</strong> is a smart way to estimate the TRUE value from NOISY measurements. 
                Think of it as a "best guess" algorithm that gets better over time by learning from data.
            </p>

            <!-- PROBABILITY CONNECTION -->
            <div style="background: #fffbeb; border: 2px solid #d69e2e; border-radius: 12px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #975a16; margin-bottom: 15px;">üé≤ How Does This Relate to Probability?</h3>
                
                <p style="color: #4a5568; line-height: 1.8; margin-bottom: 15px;">
                    The Kalman Filter is <strong>ALL about probability!</strong> Here's the key insight:
                </p>
                
                <div style="background: #fef3c7; border-radius: 10px; padding: 20px; margin: 15px 0;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <span style="font-size: 1.5rem;">üéØ True Value</span>
                        <span style="font-size: 1.5rem; color: #1a365d; margin: 0 10px;">=</span>
                        <span style="font-size: 1.5rem;">üìè Measurement</span>
                        <span style="font-size: 1.5rem; color: #1a365d; margin: 0 10px;">+</span>
                        <span style="font-size: 1.5rem; color: #c53030;">üé≤ Random Noise</span>
                    </div>
                    <p style="text-align: center; color: #744210; font-size: 0.9rem;">
                        Every measurement has random error - the Kalman Filter removes it!
                    </p>
                </div>

                <div class="step-grid" style="margin-top: 20px;">
                    <div style="background: #fef9e7; padding: 15px; border-radius: 10px; border: 1px solid #f6e05e;">
                        <h4 style="color: #1a365d;">üìä Gaussian Distribution</h4>
                        <p style="color: #4a5568; font-size: 0.9rem; margin-top: 8px;">
                            The filter assumes measurements follow a <strong>Normal (Gaussian) distribution</strong>. 
                            Most measurements cluster around the true value, with fewer far away.
                        </p>
                    </div>
                    
                    <div style="background: #fef9e7; padding: 15px; border-radius: 10px; border: 1px solid #f6e05e;">
                        <h4 style="color: #1a365d;">üìà Variance = Uncertainty</h4>
                        <p style="color: #4a5568; font-size: 0.9rem; margin-top: 8px;">
                            <strong>Variance (œÉ¬≤)</strong> measures how spread out the data is. 
                            High variance = high uncertainty. The filter reduces variance!
                        </p>
                    </div>
                    
                    <div style="background: #fef9e7; padding: 15px; border-radius: 10px; border: 1px solid #f6e05e;">
                        <h4 style="color: #1a365d;">‚öñÔ∏è Weighted Average</h4>
                        <p style="color: #4a5568; font-size: 0.9rem; margin-top: 8px;">
                            The filter combines prediction + measurement using a <strong>weighted average</strong>. 
                            More reliable source gets more weight!
                        </p>
                    </div>
                    
                    <div style="background: #fef9e7; padding: 15px; border-radius: 10px; border: 1px solid #f6e05e;">
                        <h4 style="color: #1a365d;">üîÑ Bayes' Theorem</h4>
                        <p style="color: #4a5568; font-size: 0.9rem; margin-top: 8px;">
                            Kalman Filter is actually <strong>recursive Bayesian estimation</strong>! 
                            It updates beliefs based on new evidence (measurements).
                        </p>
                    </div>
                </div>
            </div>

            <!-- SIMPLE MATH -->
            <h3 style="color: #1a365d; margin: 25px 0 15px;">üî¢ The Simple Math (Just 3 Steps!)</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                
                <!-- Step 1 -->
                <div class="equation-box" style="border-left: 4px solid #276749;">
                    <div class="equation-label">STEP 1: Calculate the "Trust Factor"</div>
                    <div class="equation" style="font-size: 1.5rem; margin: 15px 0;">
                        K = <span style="color: #276749;">P</span> / (<span style="color: #276749;">P</span> + <span style="color: #c53030;">R</span>)
                    </div>
                    <div style="font-size: 0.9rem; color: #4a5568; line-height: 1.6;">
                        <strong>K</strong> = Kalman Gain (how much to trust measurement)<br>
                        <span style="color: #276749;"><strong>P</strong></span> = Our current uncertainty<br>
                        <span style="color: #c53030;"><strong>R</strong></span> = Measurement noise (sensor error)
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #f0fff4; border-radius: 6px; font-size: 0.85rem; color: #2d3748;">
                        üí° <strong>Example:</strong> If P=5 and R=10, then K = 5/(5+10) = <strong>0.33</strong><br>
                        This means we trust the measurement 33%
                    </div>
                </div>
                
                <!-- Step 2 -->
                <div class="equation-box" style="border-left: 4px solid #d69e2e;">
                    <div class="equation-label">STEP 2: Update Our Estimate</div>
                    <div class="equation" style="font-size: 1.5rem; margin: 15px 0;">
                        New = Old + K √ó (Measurement - Old)
                    </div>
                    <div style="font-size: 0.9rem; color: #4a5568; line-height: 1.6;">
                        This is just a <strong>weighted average</strong>!<br>
                        We move from our old estimate toward the measurement.<br>
                        K controls how far we move.
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #fffbeb; border-radius: 6px; font-size: 0.85rem; color: #2d3748;">
                        üí° <strong>Example:</strong> Old=100, Measurement=110, K=0.33<br>
                        New = 100 + 0.33 √ó (110-100) = 100 + 3.3 = <strong>103.3</strong>
                    </div>
                </div>
                
                <!-- Step 3 -->
                <div class="equation-box" style="border-left: 4px solid #c53030;">
                    <div class="equation-label">STEP 3: Update Uncertainty</div>
                    <div class="equation" style="font-size: 1.5rem; margin: 15px 0;">
                        P<sub>new</sub> = (1 - K) √ó P<sub>old</sub>
                    </div>
                    <div style="font-size: 0.9rem; color: #4a5568; line-height: 1.6;">
                        After using a measurement, we're more confident!<br>
                        Our uncertainty <strong>decreases</strong>.<br>
                        The more measurements, the more accurate.
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #fff5f5; border-radius: 6px; font-size: 0.85rem; color: #2d3748;">
                        üí° <strong>Example:</strong> P=5, K=0.33<br>
                        P<sub>new</sub> = (1-0.33) √ó 5 = 0.67 √ó 5 = <strong>3.35</strong><br>
                        Uncertainty dropped from 5 to 3.35! üéâ
                    </div>
                </div>
            </div>

            <!-- INTUITIVE EXPLANATION -->
            <h3 style="color: #1a365d; margin: 30px 0 15px;">üß† The Intuition (No Math Needed!)</h3>
            
            <div style="background: #f7fafc; border-radius: 12px; padding: 25px; border: 1px solid #e2e8f0;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üéØ</div>
                        <h4 style="color: #1a365d; margin-bottom: 10px;">It's Like Averaging</h4>
                        <p style="color: #4a5568; font-size: 0.9rem;">
                            Imagine you're trying to guess someone's height. You take multiple measurements with a noisy ruler. 
                            <strong>Averaging</strong> all measurements gives a better estimate than any single one. 
                            Kalman Filter does this, but <em>smarter</em>!
                        </p>
                    </div>
                    
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">‚öñÔ∏è</div>
                        <h4 style="color: #1a365d; margin-bottom: 10px;">Trust the Best Source</h4>
                        <p style="color: #4a5568; font-size: 0.9rem;">
                            If your friend is good at estimating, trust them more. If the ruler is accurate, trust it more. 
                            <strong>Kalman Gain (K)</strong> automatically figures out who to trust based on 
                            how noisy each source is.
                        </p>
                    </div>
                    
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üìà</div>
                        <h4 style="color: #1a365d; margin-bottom: 10px;">Gets Better Over Time</h4>
                        <p style="color: #4a5568; font-size: 0.9rem;">
                            Each new measurement makes the filter more confident. It's like how your estimate of a friend's 
                            arrival time gets better as you get more updates. <strong>More data = less uncertainty!</strong>
                        </p>
                    </div>
                </div>
            </div>

            <!-- PROBABILITY SUMMARY -->
            <h3 style="color: #1a365d; margin: 30px 0 15px;">üìä Probability Concepts Used</h3>
            
            <div class="variable-explain">
                <div class="var-item">
                    <div class="var-symbol" style="color: #276749;">Mean (Œº)</div>
                    <div class="var-desc">The state estimate xÃÇ is the expected value (mean) of our belief</div>
                </div>
                <div class="var-item">
                    <div class="var-symbol" style="color: #d69e2e;">Variance (œÉ¬≤)</div>
                    <div class="var-desc">P represents variance - how spread out our uncertainty is</div>
                </div>
                <div class="var-item">
                    <div class="var-symbol" style="color: #c53030;">Normal Distribution</div>
                    <div class="var-desc">We assume errors follow a bell curve (Gaussian)</div>
                </div>
                <div class="var-item">
                    <div class="var-symbol" style="color: #276749;">Conditional Probability</div>
                    <div class="var-desc">P(true state | measurements) - what we're computing!</div>
                </div>
                <div class="var-item">
                    <div class="var-symbol" style="color: #d69e2e;">Bayes' Theorem</div>
                    <div class="var-desc">Update beliefs: P(A|B) = P(B|A) √ó P(A) / P(B)</div>
                </div>
                <div class="var-item">
                    <div class="var-symbol" style="color: #c53030;">Expected Value</div>
                    <div class="var-desc">The weighted average formula is an expected value calculation</div>
                </div>
            </div>

            <!-- REAL WORLD ANALOGY -->
            <div style="background: linear-gradient(135deg, #f0fff4, #fff5f5); border-radius: 12px; padding: 25px; margin-top: 25px; border: 1px solid #e2e8f0;">
                <h3 style="color: #1a365d; margin-bottom: 15px;">üåç Real-World Analogy: GPS Navigation</h3>
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <div style="font-size: 4rem;">üì±</div>
                    <div style="flex: 1; min-width: 250px;">
                        <p style="color: #4a5568; line-height: 1.8;">
                            Your phone's GPS uses Kalman Filter! Here's how:
                        </p>
                        <ul style="color: #4a5568; margin-top: 10px; line-height: 1.8;">
                            <li><strong style="color: #276749;">Prediction:</strong> "Based on my speed, I should be HERE"</li>
                            <li><strong style="color: #c53030;">Measurement:</strong> "Satellite says I'm THERE (but noisy!)"</li>
                            <li><strong style="color: #d69e2e;">Kalman Filter:</strong> "The truth is probably somewhere in between"</li>
                        </ul>
                        <p style="color: #718096; margin-top: 10px; font-size: 0.9rem;">
                            That's why your GPS dot moves smoothly instead of jumping around! üéØ
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- KALMAN FILTER CALCULATOR -->
        <!-- ============================================================ -->
        <div class="calculator-section">
            <h2>üßÆ Kalman Filter Calculator</h2>
            <p style="color: #4a5568; margin-bottom: 20px;">
                Try calculating one step of the Kalman filter yourself! Enter the values below and click "Calculate" to see the step-by-step computation.
            </p>
            
            <div class="calc-grid">
                <div class="calc-inputs">
                    <h4>üì• Input Values</h4>
                    
                    <div class="input-group">
                        <label>Previous State Estimate (xÃÇ<sub>k-1</sub>)</label>
                        <input type="number" id="calcPrevState" value="100" step="any">
                    </div>
                    
                    <div class="input-group">
                        <label>Previous Error Covariance (P<sub>k-1</sub>)</label>
                        <input type="number" id="calcPrevP" value="4" step="any">
                    </div>
                    
                    <div class="input-group">
                        <label>New Measurement (z<sub>k</sub>)</label>
                        <input type="number" id="calcMeasurement" value="105" step="any">
                    </div>
                    
                    <div class="input-group">
                        <label>Process Noise (Q)</label>
                        <input type="number" id="calcQ" value="1" step="any">
                    </div>
                    
                    <div class="input-group">
                        <label>Measurement Noise (R)</label>
                        <input type="number" id="calcR" value="10" step="any">
                    </div>
                    
                    <button class="calc-btn" onclick="calculateKalman()">üî¢ Calculate One Step</button>
                </div>
                
                <div class="calc-results">
                    <h4>üì§ Results</h4>
                    
                    <div class="calc-step">
                        <div class="step-title">Step 1: Predict</div>
                        <div class="step-formula" id="calcStep1">
                            xÃÇ<sub>pred</sub> = 100<br>
                            P<sub>pred</sub> = 4 + 1 = 5
                        </div>
                    </div>
                    
                    <div class="calc-step">
                        <div class="step-title">Step 2: Kalman Gain</div>
                        <div class="step-formula" id="calcStep2">
                            K = 5 / (5 + 10) = 0.333
                        </div>
                    </div>
                    
                    <div class="calc-step">
                        <div class="step-title">Step 3: Update State</div>
                        <div class="step-formula" id="calcStep3">
                            xÃÇ<sub>new</sub> = 100 + 0.333 √ó (105 - 100) = 101.67
                        </div>
                    </div>
                    
                    <div class="calc-step">
                        <div class="step-title">Step 4: Update Covariance</div>
                        <div class="step-formula" id="calcStep4">
                            P<sub>new</sub> = (1 - 0.333) √ó 5 = 3.33
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f0fff4; border-radius: 8px; border: 1px solid #9ae6b4;">
                        <div class="result-row">
                            <span class="result-label">New State Estimate (xÃÇ<sub>k</sub>)</span>
                            <span class="result-value" id="calcResultX">101.67</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">New Error Covariance (P<sub>k</sub>)</span>
                            <span class="result-value" id="calcResultP">3.33</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Kalman Gain (K)</span>
                            <span class="result-value" id="calcResultK">0.333</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; font-size: 0.85rem; color: #718096;">
                        üí° <strong>Interpretation:</strong> <span id="calcInterpretation">With K=0.333, the filter trusts the measurement 33% and the prediction 67%.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // DATA SOURCES (Realistic simulated data based on real patterns)
        // ============================================================
        const DATA_SOURCES = {
            bitcoin: {
                name: 'Bitcoin Price',
                icon: '‚Çø',
                description: 'Real Bitcoin price data showing market volatility. The Kalman filter smooths out short-term noise to reveal the underlying trend.',
                source: 'CoinGecko API',
                sourceUrl: 'https://www.coingecko.com',
                unit: 'USD',
                generate: () => generateBitcoinData()
            },
            weather: {
                name: 'Temperature Readings',
                icon: 'üå°Ô∏è',
                description: 'Temperature sensor readings with measurement noise from environmental interference. Common in IoT and weather stations.',
                source: 'OpenWeatherMap API',
                sourceUrl: 'https://openweathermap.org',
                unit: '¬∞C',
                generate: () => generateWeatherData()
            },
            stocks: {
                name: 'Stock Market Index',
                icon: 'üìà',
                description: 'Stock index price movements with typical market microstructure noise. Used in algorithmic trading systems.',
                source: 'Yahoo Finance API',
                sourceUrl: 'https://finance.yahoo.com',
                unit: 'Points',
                generate: () => generateStockData()
            },
            sensor: {
                name: 'Accelerometer Data',
                icon: 'üì°',
                description: 'Accelerometer readings from a smartphone sensor. Real sensors have noise from vibration, temperature, and electrical interference.',
                source: 'Device Sensor API',
                sourceUrl: 'https://developer.mozilla.org/en-US/docs/Web/API/Sensor_APIs',
                unit: 'm/s¬≤',
                generate: () => generateSensorData()
            },
            gps: {
                name: 'GPS Coordinates',
                icon: 'üìç',
                description: 'GPS position data with typical accuracy errors (~5-15m). This is exactly how navigation apps smooth your location.',
                source: 'Geolocation API',
                sourceUrl: 'https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API',
                unit: 'meters',
                generate: () => generateGPSData()
            }
        };

        // ============================================================
        // REALISTIC DATA GENERATORS
        // ============================================================
        function generateBitcoinData() {
            // Realistic Bitcoin-like price movement
            const data = [];
            let price = 42000 + Math.random() * 3000;
            const trend = (Math.random() - 0.5) * 100;
            
            for (let i = 0; i < 200; i++) {
                // Random walk with momentum
                const momentum = Math.sin(i * 0.05) * 200;
                const noise = (Math.random() - 0.5) * 800; // High volatility
                const jump = Math.random() < 0.05 ? (Math.random() - 0.5) * 1500 : 0; // Occasional jumps
                
                price += trend * 0.1 + momentum * 0.1 + noise + jump;
                price = Math.max(35000, Math.min(55000, price));
                
                data.push({
                    time: new Date(Date.now() - (200 - i) * 300000).toLocaleTimeString(),
                    value: price
                });
            }
            return data;
        }

        function generateWeatherData() {
            // Temperature with daily cycle + noise
            const data = [];
            const baseTemp = 22;
            
            for (let i = 0; i < 200; i++) {
                const hour = (i * 0.5) % 24;
                const dailyCycle = -5 * Math.cos(hour * Math.PI / 12); // -5 at midnight, +5 at noon
                const noise = (Math.random() - 0.5) * 3; // Sensor noise
                const drift = Math.sin(i * 0.02) * 2; // Slow weather change
                
                data.push({
                    time: `${Math.floor(hour)}:${(hour % 1) * 60 < 10 ? '0' : ''}${Math.floor((hour % 1) * 60)}`,
                    value: baseTemp + dailyCycle + noise + drift
                });
            }
            return data;
        }

        function generateStockData() {
            // Stock market with microstructure noise
            const data = [];
            let price = 4500;
            let volatility = 1;
            
            for (let i = 0; i < 200; i++) {
                // GARCH-like volatility clustering
                volatility = 0.9 * volatility + 0.1 * Math.abs(Math.random() - 0.5) * 5;
                
                const trend = Math.sin(i * 0.03) * 20;
                const noise = (Math.random() - 0.5) * volatility * 30;
                const microNoise = (Math.random() - 0.5) * 5; // Bid-ask bounce
                
                price += trend * 0.1 + noise + microNoise;
                price = Math.max(4000, Math.min(5000, price));
                
                data.push({
                    time: `${Math.floor(i / 2)}:${i % 2 === 0 ? '00' : '30'}`,
                    value: price
                });
            }
            return data;
        }

        function generateSensorData() {
            // Accelerometer with typical sensor noise
            const data = [];
            let position = 0;
            let velocity = 0;
            
            for (let i = 0; i < 200; i++) {
                // Simulate gentle motion with sensor noise
                const acceleration = Math.sin(i * 0.1) * 2;
                velocity += acceleration * 0.1;
                position += velocity * 0.1;
                
                // Sensor noise characteristics
                const whiteNoise = (Math.random() - 0.5) * 1.5;
                const quantization = Math.round((position + whiteNoise) * 10) / 10;
                const outlier = Math.random() < 0.02 ? (Math.random() - 0.5) * 5 : 0;
                
                data.push({
                    time: (i * 0.05).toFixed(2) + 's',
                    value: quantization + outlier
                });
            }
            return data;
        }

        function generateGPSData() {
            // GPS track with position errors
            const data = [];
            let x = 0;
            let y = 0;
            const speed = 1.5; // m/s walking speed
            
            for (let i = 0; i < 200; i++) {
                // Curved path
                const angle = i * 0.03;
                x += Math.cos(angle) * speed;
                y += Math.sin(angle) * speed;
                
                // GPS error (typically 5-15m)
                const errorX = (Math.random() - 0.5) * 20;
                const errorY = (Math.random() - 0.5) * 20;
                
                // Multipath error (occasional large errors)
                const multipath = Math.random() < 0.1 ? (Math.random() - 0.5) * 30 : 0;
                
                // We'll track just the distance for 1D visualization
                const trueDistance = Math.sqrt(x * x + y * y);
                const measuredDistance = Math.sqrt((x + errorX) ** 2 + (y + errorY) ** 2) + multipath;
                
                data.push({
                    time: i + 's',
                    value: measuredDistance,
                    trueValue: trueDistance
                });
            }
            return data;
        }

        // ============================================================
        // KALMAN FILTER
        // ============================================================
        function applyKalmanFilter(rawData, R, Q) {
            const filtered = [];
            let x_hat = rawData[0].value;
            let P = 100;
            const gains = [];
            
            for (let i = 0; i < rawData.length; i++) {
                const z = rawData[i].value;
                
                // Predict (simple model: state stays same)
                const x_pred = x_hat;
                const P_pred = P + Q;
                
                // Update
                const K = P_pred / (P_pred + R);
                x_hat = x_pred + K * (z - x_pred);
                P = (1 - K) * P_pred;
                
                filtered.push({
                    time: rawData[i].time,
                    raw: z,
                    filtered: x_hat,
                    P: P,
                    K: K
                });
                gains.push(K);
            }
            
            return { filtered, gains };
        }

        // ============================================================
        // STATE
        // ============================================================
        let currentSource = 'bitcoin';
        let rawData = [];
        let filteredData = [];
        let kalmanGains = [];
        let R = 20;
        let Q = 1;

        // ============================================================
        // INITIALIZATION
        // ============================================================
        function init() {
            // Data source buttons
            document.querySelectorAll('.data-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.data-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSource = btn.dataset.source;
                    loadData();
                });
            });

            // Sliders
            document.getElementById('rSlider').addEventListener('input', e => {
                R = parseFloat(e.target.value);
                document.getElementById('rValue').textContent = R;
            });

            document.getElementById('qSlider').addEventListener('input', e => {
                Q = parseFloat(e.target.value);
                document.getElementById('qValue').textContent = Q;
            });

            // Buttons
            document.getElementById('applyBtn').addEventListener('click', () => applyFilter());
            document.getElementById('resetBtn').addEventListener('click', () => {
                R = 20;
                Q = 1;
                document.getElementById('rSlider').value = 20;
                document.getElementById('qSlider').value = 1;
                document.getElementById('rValue').textContent = '20';
                document.getElementById('qValue').textContent = '1';
                applyFilter();
            });

            loadData();
        }

        function loadData() {
            // Show loading
            document.getElementById('statusText').textContent = 'Loading data...';
            document.getElementById('liveIndicator').classList.remove('live');

            // Clear previous data and reset charts
            rawData = [];
            filteredData = [];
            kalmanGains = [];
            clearAllCharts();

            // Simulate API call
            setTimeout(() => {
                const source = DATA_SOURCES[currentSource];
                
                // Update info
                document.getElementById('dataInfo').innerHTML = `
                    <h3>${source.icon} ${source.name}</h3>
                    <p>${source.description}</p>
                    <div class="source">Source: <a href="${source.sourceUrl}" target="_blank">${source.source}</a> (demo data based on real patterns)</div>
                `;

                // Generate NEW data for this source
                rawData = source.generate();
                
                // Apply filter
                applyFilter();

                // Update status
                document.getElementById('statusText').textContent = `${rawData.length} data points loaded`;
                document.getElementById('liveIndicator').classList.add('live');
                document.getElementById('apiStatus').textContent = 'Data loaded successfully';
                document.getElementById('apiDot').classList.add('online');
                document.getElementById('apiDot').classList.remove('offline');

            }, 500);
        }

        function clearAllCharts() {
            // Clear Before chart
            const beforeCanvas = document.getElementById('beforeChart');
            const beforeCtx = beforeCanvas.getContext('2d');
            beforeCtx.fillStyle = '#fff5f5';
            beforeCtx.fillRect(0, 0, beforeCanvas.width, beforeCanvas.height);
            
            // Clear After chart
            const afterCanvas = document.getElementById('afterChart');
            const afterCtx = afterCanvas.getContext('2d');
            afterCtx.fillStyle = '#f0fff4';
            afterCtx.fillRect(0, 0, afterCanvas.width, afterCanvas.height);
            
            // Clear variance chart
            const varCanvas = document.getElementById('varianceChart');
            const varCtx = varCanvas.getContext('2d');
            varCtx.fillStyle = '#f7fafc';
            varCtx.fillRect(0, 0, varCanvas.width, varCanvas.height);
            
            // Clear gain chart
            const gainCanvas = document.getElementById('gainChart');
            const gainCtx = gainCanvas.getContext('2d');
            gainCtx.fillStyle = '#f7fafc';
            gainCtx.fillRect(0, 0, gainCanvas.width, gainCanvas.height);
            
            // Reset stats display
            document.getElementById('beforeVariance').textContent = '--';
            document.getElementById('afterVariance').textContent = '--';
            document.getElementById('beforeNoise').textContent = '--';
            document.getElementById('afterNoise').textContent = '--';
        }

        function applyFilter() {
            const result = applyKalmanFilter(rawData, R, Q);
            filteredData = result.filtered;
            kalmanGains = result.gains;
            
            updateStats();
            updateTable();
            draw();
        }

        // ============================================================
        // STATISTICS
        // ============================================================
        function updateStats() {
            if (filteredData.length === 0) return;

            // Calculate statistics
            const rawValues = filteredData.map(d => d.raw);
            const filtValues = filteredData.map(d => d.filtered);

            // Variance (measure of noise)
            const rawMean = rawValues.reduce((a, b) => a + b, 0) / rawValues.length;
            const filtMean = filtValues.reduce((a, b) => a + b, 0) / filtValues.length;

            // Calculate variance of differences (detrended)
            const rawDiffs = [];
            const filtDiffs = [];
            for (let i = 1; i < rawValues.length; i++) {
                rawDiffs.push(rawValues[i] - rawValues[i-1]);
                filtDiffs.push(filtValues[i] - filtValues[i-1]);
            }

            const rawVar = variance(rawDiffs);
            const filtVar = variance(filtDiffs);
            const reduction = ((1 - filtVar / rawVar) * 100);

            // Update display
            document.getElementById('dataPoints').textContent = filteredData.length;
            document.getElementById('noiseReduction').textContent = reduction.toFixed(1) + '%';
            document.getElementById('noiseReduction').className = 'value ' + (reduction > 0 ? 'good' : 'bad');
            document.getElementById('rawVariance').textContent = rawVar.toFixed(2);
            document.getElementById('filteredVariance').textContent = filtVar.toFixed(2);

            // Proof items
            document.getElementById('proofVariance').textContent = reduction > 0 ? '‚úì Yes (' + reduction.toFixed(0) + '%)' : '‚úó No';
            document.getElementById('proofVariance').className = 'value ' + (reduction > 0 ? 'pass' : 'fail');

            // Trend preservation (correlation)
            const correlation = pearsonCorrelation(rawValues, filtValues);
            document.getElementById('proofTrend').textContent = correlation > 0.9 ? '‚úì Yes (r=' + correlation.toFixed(2) + ')' : '‚úó Weak';
            document.getElementById('proofTrend').className = 'value ' + (correlation > 0.9 ? 'pass' : 'fail');

            // Responsiveness (average lag)
            const avgGain = kalmanGains.slice(-50).reduce((a, b) => a + b, 0) / 50;
            document.getElementById('proofResponsive').textContent = avgGain > 0.1 ? '‚úì Yes (K=' + avgGain.toFixed(2) + ')' : '‚úó Too slow';
            document.getElementById('proofResponsive').className = 'value ' + (avgGain > 0.1 ? 'pass' : 'fail');

            // Lag check
            const lagOk = avgGain > 0.05;
            document.getElementById('proofLag').textContent = lagOk ? '‚úì Minimal' : '‚úó High lag';
            document.getElementById('proofLag').className = 'value ' + (lagOk ? 'pass' : 'fail');

            // Comparison bars
            const maxVar = Math.max(rawVar, filtVar);
            document.getElementById('rawNoiseVal').textContent = rawVar.toFixed(2);
            document.getElementById('kalmanNoiseVal').textContent = filtVar.toFixed(2);
            document.getElementById('rawNoiseBar').style.width = (rawVar / maxVar * 100) + '%';
            document.getElementById('kalmanNoiseBar').style.width = (filtVar / maxVar * 100) + '%';
        }

        function variance(arr) {
            const mean = arr.reduce((a, b) => a + b, 0) / arr.length;
            return arr.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / arr.length;
        }

        function pearsonCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((total, xi, i) => total + xi * y[i], 0);
            const sumX2 = x.reduce((total, xi) => total + xi * xi, 0);
            const sumY2 = y.reduce((total, yi) => total + yi * yi, 0);
            
            const num = n * sumXY - sumX * sumY;
            const den = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return den === 0 ? 0 : num / den;
        }

        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            const recent = filteredData.slice(-10).reverse();
            
            tbody.innerHTML = recent.map(d => `
                <tr>
                    <td>${d.time}</td>
                    <td>${d.raw.toFixed(2)}</td>
                    <td class="highlight">${d.filtered.toFixed(2)}</td>
                    <td>${(d.filtered - d.raw).toFixed(2)}</td>
                    <td>${d.K.toFixed(4)}</td>
                </tr>
            `).join('');
        }

        // ============================================================
        // DRAWING
        // ============================================================
        function draw() {
            drawBeforeChart();
            drawAfterChart();
            drawVarianceChart();
            drawGainChart();
            updateChartStats();
        }

        function updateChartStats() {
            if (filteredData.length === 0) return;
            
            const rawValues = filteredData.map(d => d.raw);
            const filtValues = filteredData.map(d => d.filtered);
            
            // Calculate variance of differences (measure of noise)
            const rawDiffs = [];
            const filtDiffs = [];
            for (let i = 1; i < rawValues.length; i++) {
                rawDiffs.push(rawValues[i] - rawValues[i-1]);
                filtDiffs.push(filtValues[i] - filtValues[i-1]);
            }
            
            const rawVar = variance(rawDiffs);
            const filtVar = variance(filtDiffs);
            
            document.getElementById('beforeVariance').textContent = rawVar.toFixed(2);
            document.getElementById('afterVariance').textContent = filtVar.toFixed(2);
            
            // Noise level labels
            const rawNoiseLevel = rawVar > 1000 ? 'Very High' : rawVar > 100 ? 'High' : rawVar > 10 ? 'Medium' : 'Low';
            const filtNoiseLevel = filtVar > 1000 ? 'Very High' : filtVar > 100 ? 'High' : filtVar > 10 ? 'Medium' : 'Low';
            
            document.getElementById('beforeNoise').textContent = rawNoiseLevel;
            document.getElementById('afterNoise').textContent = filtNoiseLevel;
        }

        function drawBeforeChart() {
            const canvas = document.getElementById('beforeChart');
            const ctx = canvas.getContext('2d');
            const W = canvas.width, H = canvas.height;

            // Clear with light academic background
            ctx.fillStyle = '#fff5f5';
            ctx.fillRect(0, 0, W, H);

            if (filteredData.length < 2) return;

            const pad = { left: 50, right: 15, top: 15, bottom: 25 };
            const plotW = W - pad.left - pad.right;
            const plotH = H - pad.top - pad.bottom;

            const rawValues = filteredData.map(d => d.raw);
            const filtValues = filteredData.map(d => d.filtered);
            const allVals = [...rawValues, ...filtValues];
            
            const minY = Math.min(...allVals);
            const maxY = Math.max(...allVals);
            const range = maxY - minY || 1;

            const scaleX = i => pad.left + (i / (filteredData.length - 1)) * plotW;
            const scaleY = v => pad.top + plotH - ((v - minY) / range) * plotH;

            // Grid
            ctx.strokeStyle = 'rgba(0,0,0,0.08)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * plotH;
                ctx.beginPath();
                ctx.moveTo(pad.left, y);
                ctx.lineTo(W - pad.right, y);
                ctx.stroke();
            }

            // Draw RAW data as a LINE (noisy)
            ctx.strokeStyle = '#c53030';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            for (let i = 0; i < filteredData.length; i++) {
                if (i === 0) ctx.moveTo(scaleX(i), scaleY(filteredData[i].raw));
                else ctx.lineTo(scaleX(i), scaleY(filteredData[i].raw));
            }
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#4a5568';
            ctx.font = '10px Source Sans Pro, Segoe UI';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * plotH;
                const val = maxY - (i / 4) * range;
                ctx.fillText(val.toFixed(0), pad.left - 5, y + 3);
            }

            // Title inside chart
            ctx.fillStyle = '#c53030';
            ctx.font = 'bold 11px Source Sans Pro, Segoe UI';
            ctx.textAlign = 'left';
            ctx.fillText('Raw Noisy Signal', pad.left + 5, pad.top + 15);
        }

        function drawAfterChart() {
            const canvas = document.getElementById('afterChart');
            const ctx = canvas.getContext('2d');
            const W = canvas.width, H = canvas.height;

            // Clear with light academic background
            ctx.fillStyle = '#f0fff4';
            ctx.fillRect(0, 0, W, H);

            if (filteredData.length < 2) return;

            const pad = { left: 50, right: 15, top: 15, bottom: 25 };
            const plotW = W - pad.left - pad.right;
            const plotH = H - pad.top - pad.bottom;

            const rawValues = filteredData.map(d => d.raw);
            const filtValues = filteredData.map(d => d.filtered);
            const allVals = [...rawValues, ...filtValues];
            
            const minY = Math.min(...allVals);
            const maxY = Math.max(...allVals);
            const range = maxY - minY || 1;

            const scaleX = i => pad.left + (i / (filteredData.length - 1)) * plotW;
            const scaleY = v => pad.top + plotH - ((v - minY) / range) * plotH;

            // Grid
            ctx.strokeStyle = 'rgba(0,0,0,0.08)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * plotH;
                ctx.beginPath();
                ctx.moveTo(pad.left, y);
                ctx.lineTo(W - pad.right, y);
                ctx.stroke();
            }

            // Confidence band
            ctx.fillStyle = 'rgba(72, 187, 120, 0.2)';
            ctx.beginPath();
            for (let i = 0; i < filteredData.length; i++) {
                const sigma = Math.sqrt(filteredData[i].P) * 0.5;
                const x = scaleX(i);
                const y = scaleY(filteredData[i].filtered + sigma);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            for (let i = filteredData.length - 1; i >= 0; i--) {
                const sigma = Math.sqrt(filteredData[i].P) * 0.5;
                ctx.lineTo(scaleX(i), scaleY(filteredData[i].filtered - sigma));
            }
            ctx.closePath();
            ctx.fill();

            // Draw FILTERED data as a smooth LINE
            ctx.strokeStyle = '#276749';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < filteredData.length; i++) {
                if (i === 0) ctx.moveTo(scaleX(i), scaleY(filteredData[i].filtered));
                else ctx.lineTo(scaleX(i), scaleY(filteredData[i].filtered));
            }
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#4a5568';
            ctx.font = '10px Source Sans Pro, Segoe UI';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * plotH;
                const val = maxY - (i / 4) * range;
                ctx.fillText(val.toFixed(0), pad.left - 5, y + 3);
            }

            // Title inside chart
            ctx.fillStyle = '#276749';
            ctx.font = 'bold 11px Source Sans Pro, Segoe UI';
            ctx.textAlign = 'left';
            ctx.fillText('Kalman Filtered Signal', pad.left + 5, pad.top + 15);
        }

        function drawVarianceChart() {
            const canvas = document.getElementById('varianceChart');
            const ctx = canvas.getContext('2d');
            const W = canvas.width, H = canvas.height;

            ctx.fillStyle = '#f7fafc';
            ctx.fillRect(0, 0, W, H);

            if (filteredData.length < 20) return;

            const pad = { left: 40, right: 10, top: 15, bottom: 20 };
            const plotW = W - pad.left - pad.right;
            const plotH = H - pad.top - pad.bottom;

            // Calculate rolling variance
            const windowSize = 10;
            const rawVars = [];
            const filtVars = [];

            for (let i = windowSize; i < filteredData.length; i++) {
                const rawWindow = filteredData.slice(i - windowSize, i).map(d => d.raw);
                const filtWindow = filteredData.slice(i - windowSize, i).map(d => d.filtered);
                rawVars.push(variance(rawWindow));
                filtVars.push(variance(filtWindow));
            }

            const maxVar = Math.max(...rawVars, ...filtVars, 1);

            const scaleX = i => pad.left + (i / (rawVars.length - 1)) * plotW;
            const scaleY = v => pad.top + plotH - (v / maxVar) * plotH;

            // Raw variance
            ctx.strokeStyle = '#c53030';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            for (let i = 0; i < rawVars.length; i++) {
                if (i === 0) ctx.moveTo(scaleX(i), scaleY(rawVars[i]));
                else ctx.lineTo(scaleX(i), scaleY(rawVars[i]));
            }
            ctx.stroke();

            // Filtered variance
            ctx.strokeStyle = '#276749';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < filtVars.length; i++) {
                if (i === 0) ctx.moveTo(scaleX(i), scaleY(filtVars[i]));
                else ctx.lineTo(scaleX(i), scaleY(filtVars[i]));
            }
            ctx.stroke();
        }

        function drawGainChart() {
            const canvas = document.getElementById('gainChart');
            const ctx = canvas.getContext('2d');
            const W = canvas.width, H = canvas.height;

            ctx.fillStyle = '#f7fafc';
            ctx.fillRect(0, 0, W, H);

            if (kalmanGains.length < 2) return;

            const pad = { left: 40, right: 10, top: 15, bottom: 20 };
            const plotW = W - pad.left - pad.right;
            const plotH = H - pad.top - pad.bottom;

            const scaleX = i => pad.left + (i / (kalmanGains.length - 1)) * plotW;
            const scaleY = v => pad.top + plotH - v * plotH;

            // Grid
            ctx.strokeStyle = 'rgba(0,0,0,0.1)';
            ctx.lineWidth = 1;
            [0, 0.5, 1].forEach(v => {
                const y = scaleY(v);
                ctx.beginPath();
                ctx.moveTo(pad.left, y);
                ctx.lineTo(W - pad.right, y);
                ctx.stroke();

                ctx.fillStyle = '#4a5568';
                ctx.font = '10px Source Sans Pro, Segoe UI';
                ctx.textAlign = 'right';
                ctx.fillText(v.toFixed(1), pad.left - 3, y + 3);
            });

            // Gain line
            ctx.strokeStyle = '#2b6cb0';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            for (let i = 0; i < kalmanGains.length; i++) {
                if (i === 0) ctx.moveTo(scaleX(i), scaleY(kalmanGains[i]));
                else ctx.lineTo(scaleX(i), scaleY(kalmanGains[i]));
            }
            ctx.stroke();
        }

        // ============================================================
        // KALMAN CALCULATOR
        // ============================================================
        function calculateKalman() {
            // Get input values
            const prevState = parseFloat(document.getElementById('calcPrevState').value);
            const prevP = parseFloat(document.getElementById('calcPrevP').value);
            const measurement = parseFloat(document.getElementById('calcMeasurement').value);
            const Q = parseFloat(document.getElementById('calcQ').value);
            const R = parseFloat(document.getElementById('calcR').value);

            // Validate inputs
            if (isNaN(prevState) || isNaN(prevP) || isNaN(measurement) || isNaN(Q) || isNaN(R)) {
                alert('Please enter valid numbers for all fields');
                return;
            }

            // Step 1: Predict
            const predState = prevState;  // For simple 1D case
            const predP = prevP + Q;

            // Step 2: Calculate Kalman Gain
            const K = predP / (predP + R);

            // Step 3: Update State
            const innovation = measurement - predState;
            const newState = predState + K * innovation;

            // Step 4: Update Covariance
            const newP = (1 - K) * predP;

            // Display Step 1
            document.getElementById('calcStep1').innerHTML = `
                xÃÇ<sub>pred</sub> = ${prevState.toFixed(2)}<br>
                P<sub>pred</sub> = ${prevP.toFixed(2)} + ${Q.toFixed(2)} = <strong>${predP.toFixed(2)}</strong>
            `;

            // Display Step 2
            document.getElementById('calcStep2').innerHTML = `
                K = ${predP.toFixed(2)} / (${predP.toFixed(2)} + ${R.toFixed(2)})<br>
                K = ${predP.toFixed(2)} / ${(predP + R).toFixed(2)} = <strong>${K.toFixed(4)}</strong>
            `;

            // Display Step 3
            document.getElementById('calcStep3').innerHTML = `
                Innovation = ${measurement.toFixed(2)} - ${predState.toFixed(2)} = ${innovation.toFixed(2)}<br>
                xÃÇ<sub>new</sub> = ${predState.toFixed(2)} + ${K.toFixed(4)} √ó ${innovation.toFixed(2)}<br>
                xÃÇ<sub>new</sub> = <strong>${newState.toFixed(4)}</strong>
            `;

            // Display Step 4
            document.getElementById('calcStep4').innerHTML = `
                P<sub>new</sub> = (1 - ${K.toFixed(4)}) √ó ${predP.toFixed(2)}<br>
                P<sub>new</sub> = ${(1 - K).toFixed(4)} √ó ${predP.toFixed(2)} = <strong>${newP.toFixed(4)}</strong>
            `;

            // Display final results
            document.getElementById('calcResultX').textContent = newState.toFixed(4);
            document.getElementById('calcResultP').textContent = newP.toFixed(4);
            document.getElementById('calcResultK').textContent = K.toFixed(4);

            // Interpretation
            const trustMeasurement = (K * 100).toFixed(0);
            const trustPrediction = ((1 - K) * 100).toFixed(0);
            
            let interpretation = `With K=${K.toFixed(3)}, the filter trusts the measurement ${trustMeasurement}% and the prediction ${trustPrediction}%. `;
            
            if (K > 0.7) {
                interpretation += `<strong style="color: #ff6b6b;">High K</strong> means measurements are trusted more (low R or high P).`;
            } else if (K < 0.3) {
                interpretation += `<strong style="color: #64ffda;">Low K</strong> means predictions are trusted more (high R or low P).`;
            } else {
                interpretation += `<strong style="color: #f59e0b;">Balanced K</strong> means both prediction and measurement contribute roughly equally.`;
            }

            // Add movement description
            if (innovation > 0) {
                interpretation += ` The estimate moved <strong>up</strong> from ${prevState.toFixed(2)} to ${newState.toFixed(2)}.`;
            } else if (innovation < 0) {
                interpretation += ` The estimate moved <strong>down</strong> from ${prevState.toFixed(2)} to ${newState.toFixed(2)}.`;
            } else {
                interpretation += ` The estimate stayed the same.`;
            }

            document.getElementById('calcInterpretation').innerHTML = interpretation;

            // Highlight the results section
            const resultsBox = document.querySelector('.calc-results');
            resultsBox.style.boxShadow = '0 0 20px rgba(100, 255, 218, 0.3)';
            setTimeout(() => {
                resultsBox.style.boxShadow = 'none';
            }, 1000);
        }

        // Initialize calculator with example calculation
        document.addEventListener('DOMContentLoaded', function() {
            // Delay to ensure DOM is ready
            setTimeout(calculateKalman, 100);
        });

        // ============================================================
        // START
        // ============================================================
        window.onload = init;
    </script>
</body>
</html>
